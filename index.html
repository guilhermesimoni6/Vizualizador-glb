<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste BÃ¡sico Three.js</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #222;
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #333;
            padding: 15px;
            text-align: center;
            font-size: 18px;
        }

        .viewer {
            flex: 1;
            position: relative;
            background: #444;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            background: #666;
            border: 3px solid #ff0000;
        }

        .debug {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            z-index: 1000;
            max-width: 400px;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #45a049;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #51cf66;
        }

        .warning {
            color: #ffd43b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            ğŸ”§ Teste BÃ¡sico Three.js - DiagnÃ³stico
        </div>
        
        <div class="viewer">
            <div id="canvas-container"></div>
            
            <div class="debug" id="debug">
                <div><strong>ğŸ” DIAGNÃ“STICO COMPLETO</strong></div>
                <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                <div id="step1">1. Carregando scripts...</div>
                <div id="step2">2. Verificando Three.js...</div>
                <div id="step3">3. Criando cena...</div>
                <div id="step4">4. Configurando cÃ¢mera...</div>
                <div id="step5">5. Criando renderizador...</div>
                <div id="step6">6. Adicionando objetos...</div>
                <div id="step7">7. Iniciando loop...</div>
                <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                <div id="info">Aguarde...</div>
                <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
                <div id="browser-info"></div>
            </div>

            <div class="controls">
                <button onclick="testBasicCube()">ğŸŸ© Teste Cubo</button>
                <button onclick="testColors()">ğŸŒˆ Teste Cores</button>
                <button onclick="testAnimation()">ğŸ”„ Teste AnimaÃ§Ã£o</button>
                <button onclick="showConsole()">ğŸ“‹ Console</button>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer, cube;
        let animationId;
        let testMode = 0;

        // Elementos de debug
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        const step5 = document.getElementById('step5');
        const step6 = document.getElementById('step6');
        const step7 = document.getElementById('step7');
        const info = document.getElementById('info');
        const browserInfo = document.getElementById('browser-info');

        function updateStep(stepElement, message, status = 'success') {
            const icon = status === 'success' ? 'âœ…' : status === 'error' ? 'âŒ' : 'âš ï¸';
            const className = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            stepElement.innerHTML = `<span class="${className}">${icon} ${message}</span>`;
            console.log(`${icon} ${message}`);
        }

        function updateInfo(message) {
            info.innerHTML = `<span class="warning">â„¹ï¸ ${message}</span>`;
            console.log(`INFO: ${message}`);
        }

        function showBrowserInfo() {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
            const isChrome = /Chrome/.test(userAgent);
            const webGLSupport = !!window.WebGLRenderingContext;
            
            browserInfo.innerHTML = `
                <div><strong>ğŸ“± INFORMAÃ‡Ã•ES DO DISPOSITIVO:</strong></div>
                <div>iOS: ${isIOS ? 'Sim' : 'NÃ£o'}</div>
                <div>Safari: ${isSafari ? 'Sim' : 'NÃ£o'}</div>
                <div>Chrome: ${isChrome ? 'Sim' : 'NÃ£o'}</div>
                <div>WebGL: ${webGLSupport ? 'Suportado' : 'NÃƒO SUPORTADO'}</div>
                <div>Pixel Ratio: ${window.devicePixelRatio}</div>
                <div>Tela: ${window.innerWidth}x${window.innerHeight}</div>
            `;
        }

        async function init() {
            try {
                // Passo 1: Scripts
                updateStep(step1, 'Scripts carregados');
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 2: Three.js
                if (typeof THREE === 'undefined') {
                    throw new Error('Three.js nÃ£o foi carregado');
                }
                updateStep(step2, `Three.js versÃ£o ${THREE.REVISION} carregado`);
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 3: Cena
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x87CEEB); // Azul claro
                updateStep(step3, 'Cena criada com fundo azul');
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 4: CÃ¢mera
                const container = document.getElementById('canvas-container');
                camera = new THREE.PerspectiveCamera(
                    75, 
                    container.clientWidth / container.clientHeight, 
                    0.1, 
                    1000
                );
                camera.position.set(0, 0, 5);
                updateStep(step4, `CÃ¢mera criada (${container.clientWidth}x${container.clientHeight})`);
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 5: Renderizador
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: false,
                    preserveDrawingBuffer: true
                });
                
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.outputEncoding = THREE.sRGBEncoding;
                renderer.setClearColor(0x87CEEB);
                
                // Verificar se o canvas foi criado
                if (!renderer.domElement) {
                    throw new Error('Canvas nÃ£o foi criado');
                }
                
                container.appendChild(renderer.domElement);
                updateStep(step5, 'Renderizador WebGL criado e anexado');
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 6: Objetos
                await createTestObjects();
                updateStep(step6, 'Objetos de teste criados');
                await new Promise(resolve => setTimeout(resolve, 500));

                // Passo 7: Loop
                animate();
                updateStep(step7, 'Loop de animaÃ§Ã£o iniciado');
                
                updateInfo('SUCESSO! Se vocÃª nÃ£o vÃª um cubo vermelho, hÃ¡ problema com WebGL');
                showBrowserInfo();

            } catch (error) {
                console.error('ERRO:', error);
                updateStep(step7, `ERRO: ${error.message}`, 'error');
                updateInfo(`FALHA: ${error.message}`);
                showBrowserInfo();
            }
        }

        async function createTestObjects() {
            // Cubo vermelho grande
            const geometry = new THREE.BoxGeometry(2, 2, 2);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xff0000,
                wireframe: false
            });
            cube = new THREE.Mesh(geometry, material);
            cube.position.set(0, 0, 0);
            scene.add(cube);

            // Luz ambiente
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            // Luz direcional
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            console.log('Objetos criados:', scene.children.length);
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Rotacionar cubo
            if (cube) {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
            }
            
            // Renderizar
            if (renderer && scene && camera) {
                try {
                    renderer.render(scene, camera);
                } catch (error) {
                    console.error('Erro na renderizaÃ§Ã£o:', error);
                    updateInfo(`ERRO na renderizaÃ§Ã£o: ${error.message}`);
                }
            }
        }

        function testBasicCube() {
            if (cube) {
                cube.material.color.setHex(0x00ff00); // Verde
                cube.scale.set(1.5, 1.5, 1.5);
                updateInfo('Cubo alterado para verde e aumentado');
            }
        }

        function testColors() {
            if (scene) {
                const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff];
                const color = colors[Math.floor(Math.random() * colors.length)];
                scene.background.setHex(color);
                updateInfo(`Cor de fundo alterada para #${color.toString(16)}`);
            }
        }

        function testAnimation() {
            testMode = (testMode + 1) % 3;
            
            if (cube) {
                switch(testMode) {
                    case 0:
                        cube.rotation.set(0, 0, 0);
                        updateInfo('AnimaÃ§Ã£o: RotaÃ§Ã£o normal');
                        break;
                    case 1:
                        cube.rotation.set(Math.PI/4, Math.PI/4, 0);
                        updateInfo('AnimaÃ§Ã£o: RotaÃ§Ã£o rÃ¡pida');
                        break;
                    case 2:
                        cube.position.set(
                            Math.sin(Date.now() * 0.001) * 2,
                            Math.cos(Date.now() * 0.001) * 2,
                            0
                        );
                        updateInfo('AnimaÃ§Ã£o: Movimento circular');
                        break;
                }
            }
        }

        function showConsole() {
            console.log('=== INFORMAÃ‡Ã•ES DE DEBUG ===');
            console.log('Scene:', scene);
            console.log('Camera:', camera);
            console.log('Renderer:', renderer);
            console.log('Cube:', cube);
            console.log('Canvas:', renderer?.domElement);
            console.log('WebGL Context:', renderer?.getContext());
            console.log('=========================');
            updateInfo('InformaÃ§Ãµes logadas no console (F12)');
        }

        // Redimensionar
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                const container = document.getElementById('canvas-container');
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
                updateInfo('Tela redimensionada');
            }
        });

        // Detectar erros
        window.addEventListener('error', (e) => {
            console.error('Erro global:', e);
            updateInfo(`ERRO: ${e.message}`);
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            updateInfo('DOM carregado, iniciando testes...');
            setTimeout(init, 1000);
        });
    </script>
</body>
</html>
